(function(e,i,l){var h="beforeChangeOffset";var r="afterChangeOffset";var c="pullstart";var p="pulling";var b=h;var f=r;var q="dragEndAfterChangeOffset";var a=e.className("transitioning");var g=e.className("pull-top-tips");var k=e.className("pull-bottom-tips");var d=e.className("pull-loading");var s=e.className("scroll");var j=e.className("pull-loading")+" "+e.className("icon")+" "+e.className("icon-pulldown");var o=j+" "+e.className("reverse");var m=e.className("pull-loading")+" "+e.className("spinner");var n=e.className("hidden");var t="."+d;e.PullToRefresh=e.Class.extend({init:function(v,u){this.element=v;this.options=e.extend(true,{down:{height:75,callback:false,},up:{auto:false,offset:100,show:true,contentinit:"上拉显示更多",contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:false},preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/}},u);this.stopped=this.isNeedRefresh=this.isDragging=false;this.state=h;this.isInScroll=this.element.classList.contains(s);this.initPullUpTips();this.initEvent()},_preventDefaultException:function(w,v){for(var u in v){if(v[u].test(w[u])){return true}}return false},initEvent:function(){if(e.isFunction(this.options.down.callback)){this.element.addEventListener(e.EVENT_START,this);this.element.addEventListener("drag",this);this.element.addEventListener("dragend",this)}if(this.pullUpTips){this.element.addEventListener("dragup",this);if(this.isInScroll){this.element.addEventListener("scrollbottom",this)}else{i.addEventListener("scroll",this)}}},handleEvent:function(u){switch(u.type){case e.EVENT_START:this.isInScroll&&this._canPullDown()&&u.target&&!this._preventDefaultException(u.target,this.options.preventDefaultException)&&u.preventDefault();break;case"drag":this._drag(u);break;case"dragend":this._dragend(u);break;case"webkitTransitionEnd":this._transitionEnd(u);break;case"dragup":case"scroll":this._dragup(u);break;case"scrollbottom":if(u.target===this.element){this.pullUpLoading(u)}break}},initPullDownTips:function(){var u=this;if(e.isFunction(u.options.down.callback)){u.pullDownTips=(function(){var v=l.querySelector("."+g);if(v){v.parentNode.removeChild(v)}if(!v){v=l.createElement("div");v.classList.add(g);v.innerHTML='<div class="mui-pull-top-wrapper"><span class="mui-pull-loading mui-icon mui-icon-pulldown"></span></div>';v.addEventListener("webkitTransitionEnd",u)}u.pullDownTipsIcon=v.querySelector(t);l.body.appendChild(v);return v}())}},initPullUpTips:function(){var u=this;if(e.isFunction(u.options.up.callback)){u.pullUpTips=(function(){var v=u.element.querySelector("."+k);if(!v){v=l.createElement("div");v.classList.add(k);if(!u.options.up.show){v.classList.add(n)}v.innerHTML='<div class="mui-pull-bottom-wrapper"><span class="mui-pull-loading">'+u.options.up.contentinit+"</span></div>";u.element.appendChild(v)}u.pullUpTipsIcon=v.querySelector(t);return v}())}},_transitionEnd:function(u){if(u.target===this.pullDownTips&&this.removing){this.removePullDownTips()}},_dragup:function(v){var u=this;if(u.loading){return}if(v&&v.detail&&e.gestures.session.drag){u.isDraggingUp=true}else{if(!u.isDraggingUp){return}}if(!u.isDragging){if(u._canPullUp()){u.pullUpLoading(v)}}},_canPullUp:function(){if(this.removing){return false}if(this.isInScroll){var u=this.element.parentNode.getAttribute("data-scroll");if(u){var v=e.data[u];return v.y===v.maxScrollY}}return i.pageYOffset+i.innerHeight+this.options.up.offset>=l.documentElement.scrollHeight},_canPullDown:function(){if(this.removing){return false}if(this.isInScroll){var u=this.element.parentNode.getAttribute("data-scroll");if(u){var v=e.data[u];return v.y===0}}return l.body.scrollTop===0},_drag:function(y){if(this.loading||this.stopped){y.stopPropagation();y.detail.gesture.preventDefault();return}var w=y.detail;if(!this.isDragging){if(w.direction==="down"&&this._canPullDown()){if(l.querySelector("."+g)){y.stopPropagation();y.detail.gesture.preventDefault();return}this.isDragging=true;this.removing=false;this.startDeltaY=w.deltaY;e.gestures.session.lockDirection=true;e.gestures.session.startDirection=w.direction;this._pullStart(this.startDeltaY)}}if(this.isDragging){y.stopPropagation();y.detail.gesture.preventDefault();var u=w.deltaY-this.startDeltaY;u=Math.min(u,1.5*this.options.down.height);this.deltaY=u;this._pulling(u);var x=u>this.options.down.height?r:h;if(this.state!==x){this.state=x;if(this.state===r){this.removing=false;this.isNeedRefresh=true}else{this.removing=true;this.isNeedRefresh=false}this["_"+x](u)}if(e.os.ios&&parseFloat(e.os.version)>=8){var v=w.gesture.touches[0].clientY;if((v+10)>i.innerHeight||v<10){this._dragend(y);return}}}},_dragend:function(v){var u=this;if(u.isDragging){u.isDragging=false;u._dragEndAfterChangeOffset(u.isNeedRefresh)}if(u.isPullingUp){if(u.pullingUpTimeout){clearTimeout(u.pullingUpTimeout)}u.pullingUpTimeout=setTimeout(function(){u.isPullingUp=false},1000)}},_pullStart:function(u){this.pullStart(u);e.trigger(this.element,c,{api:this,startDeltaY:u})},_pulling:function(u){this.pulling(u);e.trigger(this.element,p,{api:this,deltaY:u})},_beforeChangeOffset:function(u){this.beforeChangeOffset(u);e.trigger(this.element,b,{api:this,deltaY:u})},_afterChangeOffset:function(u){this.afterChangeOffset(u);e.trigger(this.element,f,{api:this,deltaY:u})},_dragEndAfterChangeOffset:function(u){this.dragEndAfterChangeOffset(u);e.trigger(this.element,q,{api:this,isNeedRefresh:u})},removePullDownTips:function(){if(this.pullDownTips){try{this.pullDownTips.parentNode&&this.pullDownTips.parentNode.removeChild(this.pullDownTips);this.pullDownTips=null;this.removing=false}catch(u){}}},pullStart:function(u){this.initPullDownTips(u)},pulling:function(u){this.pullDownTips.style.webkitTransform="translate3d(0,"+u+"px,0)"},beforeChangeOffset:function(u){this.pullDownTipsIcon.className=j},afterChangeOffset:function(u){this.pullDownTipsIcon.className=o},dragEndAfterChangeOffset:function(u){if(u){this.pullDownTipsIcon.className=m;this.pullDownLoading()}else{this.pullDownTipsIcon.className=j;this.endPullDownToRefresh()}},pullDownLoading:function(){if(this.loading){return}if(!this.pullDownTips){this.initPullDownTips();this.dragEndAfterChangeOffset(true);return}this.loading=true;this.pullDownTips.classList.add(a);this.pullDownTips.style.webkitTransform="translate3d(0,"+this.options.down.height+"px,0)";this.options.down.callback.apply(this)},pullUpLoading:function(u){if(this.loading||this.finished){return}this.loading=true;this.isDraggingUp=false;this.pullUpTips.classList.remove(n);u&&u.detail&&u.detail.gesture&&u.detail.gesture.preventDefault();this.pullUpTipsIcon.innerHTML=this.options.up.contentrefresh;this.options.up.callback.apply(this)},endPullDownToRefresh:function(){this.loading=false;this.pullUpTips&&this.pullUpTips.classList.remove(n);this.pullDownTips.classList.add(a);this.pullDownTips.style.webkitTransform="translate3d(0,0,0)";if(this.deltaY<=0){this.removePullDownTips()}else{this.removing=true}if(this.isInScroll){e(this.element.parentNode).scroll().refresh()}},endPullUpToRefresh:function(u){if(u){this.finished=true;this.pullUpTipsIcon.innerHTML=this.options.up.contentnomore;this.element.removeEventListener("dragup",this);i.removeEventListener("scroll",this)}else{this.pullUpTipsIcon.innerHTML=this.options.up.contentdown}this.loading=false;if(this.isInScroll){e(this.element.parentNode).scroll().refresh()}},setStopped:function(u){if(u!=this.stopped){this.stopped=u;this.pullUpTips&&this.pullUpTips.classList[u?"add":"remove"](n)}},refresh:function(u){if(u&&this.finished&&this.pullUpTipsIcon){this.pullUpTipsIcon.innerHTML=this.options.up.contentdown;this.element.addEventListener("dragup",this);i.addEventListener("scroll",this);this.finished=false}}});e.fn.pullToRefresh=function(u){var v=[];u=u||{};this.each(function(){var w=this;var y=null;var x=w.getAttribute("data-pullToRefresh");if(!x){x=++e.uuid;e.data[x]=y=new e.PullToRefresh(w,u);w.setAttribute("data-pullToRefresh",x)}else{y=e.data[x]}if(u.up&&u.up.auto){y.pullUpLoading()}v.push(y)});return v.length===1?v[0]:v}})(mui,window,document);