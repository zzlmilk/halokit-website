(function(j,q){var k=j.className("left");var x=j.className("center");var i=j.className("right");var n=j.className("page");var m=j.className("page-left");var u=j.className("page-center");var t=j.className("navbar-left");var h=j.className("navbar-center");var c=j.className("page-shadow");var e=j.className("transitioning");var s="."+k;var p="."+x;var v="."+i;var g=j.classSelector(".icon");var d=j.classSelector(".navbar");var o=j.classSelector(".navbar-inner");var l=j.classSelector(".pages");var b=j.classSelector(".btn-nav");var a="."+m;var r="."+u;var y="."+t;var f="."+h;var w=j.Class.extend({init:function(A,z){this.view=this.element=A;this.options=j.extend({animateNavbar:"ios",swipeBackPageActiveArea:30,hardwareAccelerated:true},z);this.navbars=this.view.querySelector(d);this.pages=this.view.querySelector(l);this.history=[];this.maxScrollX=this.view.offsetWidth;this.x=this.y=0;this.translateZ=this.options.hardwareAccelerated?" translateZ(0)":"";this.ratio=0;this.isBack=true;this.moved=this.dragging=false;this.activeNavbar=this.previousNavbar=null;this.activePage=this.previousPage=null;this._initPageEventMethod();this._initDefaultPage();this.navbars&&this._initNavBar();this.initEvent()},_initPageEventMethod:function(){var z=this;j.each(["onPageBeforeShow","onPageShow","onPageBeforeBack","onPageBack"],function(A,B){z[B+"Callbacks"]={};z[B]=function(D,E){var C=B+"Callbacks";if(!z[C].hasOwnProperty(D)){z[C][D]=[E]}else{z[C][D].push(E)}}})},_initDefaultPage:function(){var z=document.querySelector(this.options.defaultPage);if(z){this._appendPage(z)}else{throw new Error("defaultPage["+this.options.defaultPage+"] does not exist")}},initEvent:function(){this.view.addEventListener("click",this);this.view.addEventListener("tap",this);this.pages.addEventListener("drag",this);this.pages.addEventListener("dragend",this);this.pages.addEventListener("webkitTransitionEnd",this)},handleEvent:function(z){switch(z.type){case"click":this._click(z);break;case"tap":this._tap(z);break;case"drag":this._drag(z);break;case"dragend":this._dragend(z);break;case"webkitTransitionEnd":this._webkitTransitionEnd(z);break}},shadow:function(){var z=document.createElement("div");z.className=c;return z}(),_removePage:function(A,z){z&&this._removeNavbar(A,z);document.body.appendChild(A);this._cleanPageClass(A)},_prependPage:function(A){var z=A.querySelector(o);z&&this._prependNavbar(z);A.classList.add(m);this.pages.insertBefore(A,this.pages.firstElementChild)},_appendPage:function(A){var z=A.querySelector(o);z&&this._appendNavbar(z);A.classList.add(u);this.pages.appendChild(A)},_removeNavbar:function(A,z){A.insertBefore(z,A.firstElementChild);this._cleanNavbarClass(z)},_prependNavbar:function(z){z.classList.add(t);this.navbars.insertBefore(z,this.navbars.firstElementChild)},_appendNavbar:function(z){z.classList.add(h);this.navbars.appendChild(z)},_cleanPageClass:function(z){z.classList.remove(u);z.classList.remove(m)},_cleanNavbarClass:function(z){z.classList.remove(h);z.classList.remove(t)},_tap:function(z){var B=z.target;for(;B&&B!==document;B=B.parentNode){if(B.tagName==="A"&&B.hash){var A=document.getElementById(B.hash.replace("#",""));if(A&&A.classList.contains(n)){z.stopPropagation();z.detail.gesture.preventDefault();this.go(B.hash);break}}}},_click:function(z){var B=z.target;for(;B&&B!==document;B=B.parentNode){if(B.tagName==="A"&&B.hash){var A=document.getElementById(B.hash.replace("#",""));if(A&&A.classList.contains(n)){z.preventDefault();break}}}},_cleanStyle:function(z){if(z){z.style.webkitTransform="";z.style.opacity=""}},_isAnimateNavbarIOS:function(){return !j.os.android&&this.options.animateNavbar==="ios"},_webkitTransitionEnd:function(B){this.dragging=this.moved=false;if(this.activePage!==B.target){return}this.isInTransition=false;this.shadow.parentNode===this.activePage&&this.activePage.removeChild(this.shadow);this.previousPageClassList.remove(e);this.activePageClassList.remove(e);var z=this;if(this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements){var A=this.isBack;j.each(this.previousNavElements,function(C,D){D.classList.remove(e);A&&z._cleanStyle(D)});j.each(this.activeNavElements,function(C,D){D.classList.remove(e);z._cleanStyle(D)});if(this.previousNavBackIcon){this.previousNavBackIcon.classList.remove(e);A&&this._cleanStyle(this.previousNavBackIcon)}if(this.activeNavBackIcon){this.activeNavBackIcon.classList.remove(e);this._cleanStyle(this.activeNavBackIcon)}}else{this.previousNavbar&&this.previousNavbar.classList.remove(e);this.activeNavbar&&this.activeNavbar.classList.remove(e);this._cleanStyle(this.previousNavbar);this._cleanStyle(this.activeNavbar)}this._cleanStyle(this.previousPage);this._cleanStyle(this.activePage);if(this.ratio<=0.5){return}if(this.isBack){this._removePage(this.activePage,this.activeNavbar);this.previousPageClassList.remove(m);this.previousPageClassList.add(u);if(this.previousNavbar){this.previousNavbar.classList.remove(t);this.previousNavbar.classList.add(h)}if(this.history.length>0){this._prependPage(this.history.pop())}this.navbars&&this._initNavBar();this._trigger("pageBack",this.activePage);this._trigger("pageShow",this.previousPage)}else{this.previousPageClassList.add(m);this.activePageClassList.add(u);this._trigger("pageShow",this.activePage)}},_trigger:function(B,E){var A="on"+B.charAt(0).toUpperCase()+B.slice(1)+"Callbacks";if(this[A].hasOwnProperty(E.id)){var D=this[A][E.id];var C=new CustomEvent(B,{detail:{page:E},bubbles:true,cancelable:true});for(var z=D.length;z--;){D[z].call(this,C)}}j.trigger(this.view,B,{page:E})},_initPageTransform:function(){this.previousPage=this.pages.querySelector(a);this.activePage=this.pages.querySelector(r);if(this.previousPage&&this.activePage){this.activePage.appendChild(this.shadow);this.previousPageClassList=this.previousPage.classList;this.activePageClassList=this.activePage.classList;this.previousPageStyle=this.previousPage.style;this.activePageStyle=this.activePage.style;this.previousPageClassList.remove(e);this.activePageClassList.remove(e);if(this.navbars){this.previousNavbar=this.navbars.querySelector(y);this.activeNavbar=this.navbars.querySelector(f);if(this._isAnimateNavbarIOS()&&this.previousNavbar&&this.activeNavbar){this.previousNavElements=this.previousNavbar.querySelectorAll(s+","+p+","+v);this.activeNavElements=this.activeNavbar.querySelectorAll(s+","+p+","+v);this.previousNavBackIcon=this.previousNavbar.querySelector(s+b+" "+g);this.activeNavBackIcon=this.activeNavbar.querySelector(s+b+" "+g)}}this.x=0;this.dragging=true;return true}return false},_initNavBar:function(){if(this._isAnimateNavbarIOS()&&this.navbars){var C=this.navbars.querySelectorAll(o);var P,B,M,z,D,K,O,J,I,F,L,N;for(var E=0,H=C.length;E<H;E++){P=C[E];B=P.querySelector(s);M=P.querySelector(v);z=P.querySelector(p);J=!B;noRight=!M;D=J?0:B.offsetWidth;K=noRight?0:M.offsetWidth;O=z?z.offsetWidth:0;N=this.maxScrollX;onLeft=P.classList.contains("navbar-left");if(noRight){F=N-O}if(J){F=0}if(!J&&!noRight){F=(N-K-O+D)/2}var G=(N-O)/2;if(N-D-K>O){if(G<D){G=D}if(G+O>N-K){G=N-K-O}L=G-F}else{L=0}var A=L;if(z){z.style.marginLeft=-D+"px";z.mNavbarLeftOffset=-(F+L)+30;z.mNavbarRightOffset=N-F-L-O}if(onLeft){z.style.webkitTransform=("translate3d("+z.mNavbarLeftOffset+"px, 0, 0)")}if(!J){B.mNavbarLeftOffset=-D;B.mNavbarRightOffset=(N-D)/2;if(onLeft){B.style.webkitTransform=("translate3d("+B[0].mNavbarLeftOffset+"px, 0, 0)")}}if(!noRight){M.mNavbarLeftOffset=-(N-K)/2;M.mNavbarRightOffset=K;if(onLeft){M.style.webkitTransform=("translate3d("+M[0].mNavbarLeftOffset+"px, 0, 0)")}}}}},_drag:function(B){if(this.isInTransition){return}var A=B.detail;if(!this.dragging){if((j.gestures.session.firstTouch.center.x-this.view.offsetLeft)<this.options.swipeBackPageActiveArea){this.isBack=true;this._initPageTransform()}}if(this.dragging){var z=0;if(!this.moved){z=A.deltaX;j.gestures.session.lockDirection=true;j.gestures.session.startDirection=A.direction}else{z=A.deltaX-(j.gestures.session.prevTouch&&j.gestures.session.prevTouch.deltaX||0)}var C=this.x+z;if(C<0||C>this.maxScrollX){C=C<0?0:this.maxScrollX}B.stopPropagation();A.gesture.preventDefault();if(!this.requestAnimationFrame){this._updateTranslate()}this.moved=true;this.x=C;this.y=0}},_dragend:function(A){if(!this.moved){return}A.stopPropagation();var z=A.detail;this._clearRequestAnimationFrame();this._prepareTransition();this.ratio=this.x/this.maxScrollX;if(this.ratio===1||this.ratio===0){j.trigger(this.activePage,"webkitTransitionEnd");return}if(this.ratio>0.5){this.setTranslate(this.maxScrollX,0)}else{this._cleanStyle(this.previousPage);this._cleanStyle(this.activePage)}},_prepareTransition:function(){this.isInTransition=true;this.previousPageClassList.add(e);this.activePageClassList.add(e);var z=this;if(this.previousNavbar&&this.activeNavbar){this.previousNavbar.classList.add(e);this.activeNavbar.classList.add(e);if(this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements){j.each(this.previousNavElements,function(A,B){B.classList.add(e);z._cleanStyle(B)});j.each(this.activeNavElements,function(A,B){B.classList.add(e);z._cleanStyle(B)});if(this.previousNavBackIcon){this._cleanStyle(this.previousNavBackIcon);this.previousNavBackIcon.classList.add(e)}if(this.activeNavBackIcon){this._cleanStyle(this.activeNavBackIcon);this.activeNavBackIcon.classList.add(e)}}}},_clearRequestAnimationFrame:function(){if(this.requestAnimationFrame){cancelAnimationFrame(this.requestAnimationFrame);this.requestAnimationFrame=null}},_getTranslateStr:function(z,A){if(this.options.hardwareAccelerated){return"translate3d("+z+"px,"+A+"px,0px) "+this.translateZ}return"translate("+z+"px,"+A+"px) "},_updateTranslate:function(){var z=this;if(z.x!==z.lastX||z.y!==z.lastY){z.setTranslate(z.x,z.y)}z.requestAnimationFrame=requestAnimationFrame(function(){z._updateTranslate()})},_setNavbarTranslate:function(z,B){var A=z/this.maxScrollX;if(this._isAnimateNavbarIOS()){if(this.previousNavElements&&this.activeNavElements){this.animateNavbarByIOS(A)}}else{this.activeNavbar.style.opacity=1-A*1.3;this.previousNavbar.style.opacity=A*1.3-0.3}},animateNavbarByIOS:function(A){var B,z,D,C;for(B=0,z=this.activeNavElements.length;B<z;B++){C=this.activeNavElements[B];D=C.style;D.opacity=(1-A*(C.classList.contains(k)?3.5:1.3));if(!C.classList.contains(i)){var E=A*C.mNavbarRightOffset;C.style.webkitTransform=("translate3d("+E+"px,0,0)");if(C.classList.contains(k)&&this.activeNavBackIcon){this.activeNavBackIcon.style.webkitTransform=("translate3d("+-E+"px,0,0)")}}}for(B=0,z=this.previousNavElements.length;B<z;B++){C=this.previousNavElements[B];D=C.style;D.opacity=A*1.3-0.3;if(!C.classList.contains(i)){var F=C.mNavbarLeftOffset*(1-A);C.style.webkitTransform=("translate3d("+F+"px,0,0)");if(C.classList.contains(k)&&this.previousNavBackIcon){this.previousNavBackIcon.style.webkitTransform=("translate3d("+-F+"px,0,0)")}}}},setTranslate:function(z,A){this.x=z;this.y=A;this.previousPage.style.opacity=0.9+0.1*z/this.maxScrollX;this.previousPage.style.webkitTransform=this._getTranslateStr((z/6-this.maxScrollX/6),A);this.activePage.style.webkitTransform=this._getTranslateStr(z,A);this.navbars&&this._setNavbarTranslate(z,A);this.lastX=this.x;this.lastY=this.y},canBack:function(){return this.pages.querySelector(a)},back:function(){if(this.isInTransition){return}this.isBack=true;this.ratio=1;if(this._initPageTransform()){this._trigger("pageBeforeBack",this.activePage);this._trigger("pageBeforeShow",this.previousPage);this._prepareTransition();this.previousPage.offsetHeight;this.activePage.offsetHeight;this.setTranslate(this.maxScrollX,0)}},go:function(D){if(this.isInTransition){return}var A=document.querySelector(D);if(A){var B=this.pages.querySelector(a);var E=this.pages.querySelector(r);var z;var C;if(this.navbars){z=this.navbars.querySelector(y);C=this.navbars.querySelector(f)}if(C){C.classList.remove(h);C.classList.add(t)}if(B){this._removePage(B,z);this.history.push(B)}if(E){E.classList.remove(u);E.style.webkitTransform="translate3d(0,0,0)";E.classList.add(m)}A.style.webkitTransform="translate3d(100%,0,0)";this._appendPage(A);A.appendChild(this.shadow);A.offsetHeight;this.isBack=false;this.ratio=1;this._initPageTransform();this.navbars&&this._initNavBar();this.navbars&&this._setNavbarTranslate(this.maxScrollX,0);this.previousPage.offsetHeight;this.activePage.offsetHeight;if(this.navbars){this.previousNavbar.offsetHeight;this.activeNavbar.offsetHeight}this._trigger("pageBeforeShow",this.activePage);this._prepareTransition();this.setTranslate(0,0)}}});j.fn.view=function(A){var z=this[0];var B=null;var C=z.getAttribute("data-view");if(!C){C=++j.uuid;j.data[C]=B=new w(z,A);z.setAttribute("data-view",C)}else{B=j.data[C]}return B}})(mui,window);