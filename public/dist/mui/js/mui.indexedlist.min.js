(function(d,c,a){var e=function(f){return"."+d.className(f)};var b=d.IndexedList=d.Class.extend({init:function(h,g){var f=this;f.options=g||{};f.box=h;if(!f.box){throw"实例 IndexedList 时需要指定 element"}f.createDom();f.findElements();f.caleLayout();f.bindEvent()},createDom:function(){var f=this;f.el=f.el||{};f.el.styleForSearch=a.createElement("style");(a.head||a.body).appendChild(f.el.styleForSearch)},findElements:function(){var f=this;f.el=f.el||{};f.el.search=f.box.querySelector(e("indexed-list-search"));f.el.searchInput=f.box.querySelector(e("indexed-list-search-input"));f.el.searchClear=f.box.querySelector(e("indexed-list-search")+" "+e("icon-clear"));f.el.bar=f.box.querySelector(e("indexed-list-bar"));f.el.barItems=[].slice.call(f.box.querySelectorAll(e("indexed-list-bar")+" a"));f.el.inner=f.box.querySelector(e("indexed-list-inner"));f.el.items=[].slice.call(f.box.querySelectorAll(e("indexed-list-item")));f.el.liArray=[].slice.call(f.box.querySelectorAll(e("indexed-list-inner")+" li"));f.el.alert=f.box.querySelector(e("indexed-list-alert"))},caleLayout:function(){var f=this;var h=(f.box.offsetHeight-f.el.search.offsetHeight)+"px";f.el.bar.style.height=h;f.el.inner.style.height=h;var g=((f.el.bar.offsetHeight-40)/f.el.barItems.length)+"px";f.el.barItems.forEach(function(i){i.style.height=g;i.style.lineHeight=g})},scrollTo:function(h){var f=this;var g=f.el.inner.querySelector('[data-group="'+h+'"]');if(!g||(f.hiddenGroups&&f.hiddenGroups.indexOf(g)>-1)){return}f.el.inner.scrollTop=g.offsetTop},bindBarEvent:function(){var f=this;var h=null;var i=function(k){if(h){h.classList.remove("active");h=null}f.el.bar.classList.add("active");var j=k.changedTouches?k.changedTouches[0]:k;h=a.elementFromPoint(j.pageX,j.pageY);if(h){var l=h.innerText;if(l&&l.length==1){h.classList.add("active");f.el.alert.innerText=l;f.el.alert.classList.add("active");f.scrollTo(l)}}k.preventDefault()};var g=function(j){f.el.alert.classList.remove("active");f.el.bar.classList.remove("active");if(h){h.classList.remove("active");h=null}};f.el.bar.addEventListener(d.EVENT_MOVE,function(j){i(j)},false);f.el.bar.addEventListener(d.EVENT_START,function(j){i(j)},false);a.body.addEventListener(d.EVENT_END,function(j){g(j)},false);a.body.addEventListener(d.EVENT_CANCEL,function(j){g(j)},false)},search:function(g){var f=this;g=(g||"").toLowerCase();var h=[];var j=-1;var l=0;var m=f.el.liArray;var k=m.length;f.hiddenGroups=[];var i=function(n,o){if(l>=n-j-(o?0:1)){h.push(e("indexed-list-inner li")+":nth-child("+(j+1)+")");f.hiddenGroups.push(m[j])}j=n;l=0};m.forEach(function(p){var n=m.indexOf(p);if(p.classList.contains(d.className("indexed-list-group"))){i(n,false)}else{var r=(p.innerText||"").toLowerCase();var q=(p.getAttribute("data-value")||"").toLowerCase();var o=(p.getAttribute("data-tags")||"").toLowerCase();if(g&&r.indexOf(g)<0&&q.indexOf(g)<0&&o.indexOf(g)<0){h.push(e("indexed-list-inner li")+":nth-child("+(n+1)+")");l++}if(n>=k-1){i(n,true)}}});if(h.length>=k){f.el.inner.classList.add("empty")}else{if(h.length>0){f.el.inner.classList.remove("empty");f.el.styleForSearch.innerText=h.join(", ")+"{display:none;}"}else{f.el.inner.classList.remove("empty");f.el.styleForSearch.innerText=""}}},bindSearchEvent:function(){var f=this;f.el.searchInput.addEventListener("input",function(){var g=this.value;f.search(g)},false);d(f.el.search).on("tap",e("icon-clear"),function(){f.search("")},false)},bindEvent:function(){var f=this;f.bindBarEvent();f.bindSearchEvent()}});d.fn.indexedList=function(f){this.each(function(h,g){if(g.indexedList){return}g.indexedList=new b(g,f)});return this[0]?this[0].indexedList:null}})(mui,window,document);