new loader(["/dist/js/jq.js","/dist/js/base.js","http://pv.sohu.com/cityjson?ie=utf-8"],function(e){var t=$("#personal"),n=null;t.on("click",".pay-btn.pay",function(e){var t={orderSn:$(this).data("ordersn"),spbill_create_ip:returnCitySN.cip};t.orderSn&&t.spbill_create_ip?(n=Base.setTip("查询订单中..."),$.ajax({url:"/h5/payByOrderSn",type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(e){n.hide(),e.status?r.onBridgeReady(e.data):$(".err-word").text(e.msg).show()},error:function(e){n.hide(),$(".err-word").text("网络错误，请重试").show()}})):$(".err-word").text("订单有误，请刷新页面").show()}).on("click",".send-btn",function(e){var t=$(this).data("id");confirm("此操作不可撤销，点击确定继续，点击取消返回")&&(t||$(".err-word").text("订单有误，请刷新页面").show(),n=Base.setTip("查询订单中..."),$.get("/h5/refund/"+t,function(e){n.hide(),e.status?window.location.reload():$(".err-word").text(e.msg).show()}))}).on("click",".sure-btn",function(e){if(confirm("此操作不可撤销，点击确定继续，点击取消返回")){var t=$(this).data("id");if(t){var r=["/h5/send/",t,"?status=","CUSTRECEIVE"];n=Base.setTip("查询订单中..."),$.get(r.join(""),function(e){n.hide(),e.status?window.location.reload():$(".err-word").text(e.msg).show()})}else $(".err-word").text("订单有误，请刷新页面").show()}});var r={onBridgeReady:function(e){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){n.hide(),"get_brand_wcpay_request:ok"===e.err_msg?r.redirect(!0):r.redirect(!1)})}"prepay_id=undefined"===e["package"]?(alert("商户订单重复"),r.redirect("false")):(n.text("支付中...").show(),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t())},redirect:function(e){e||$(".err-word").text("支付失败").show(),setTimeout(function(){location.href="/h5/personal?status="+(e?"CUSTPAY":"CUSTCONFIRM")},600)}}}).jsLoader();